<!doctype HTML>

<html>
  <head>
    <meta charset="utf-8">
    <script type="text/javascript" src="../assets/jquery-2.1.0.min.js"></script>
	<script type="text/javascript" src="../assets/pd-fileutils.js"></script>
    <script type="text/javascript" src="../../dist/webpd-latest.js"></script>
    <script type="text/javascript" src="../assets/nexusUI.js"></script>
	<script type="text/javascript" src="../assets/webaudiohaptics.js"></script>
  </head>

  <body>
	  
    <style>
      body {
        text-align:center;
      } 
    </style>

    <h1 style="font-family:helvetica neue;font-weight:300">Activity 3B sensor</h1>
	<h2 style="font-family:helvetica neue;font-weight:200">In (sensor)</h2>
	<canvas nx="meter" id="meterIn" height="125" width="25"></canvas>
	<canvas nx="oscilloscope" id="oscilloscopeIn"></canvas>
	<h2 style="font-family:helvetica neue;font-weight:200">Out (haptics)</h2>
	<canvas nx="meter" id="meterOut" height="125" width="25"></canvas>
	<canvas nx="oscilloscope" id="oscilloscopeOut"></canvas>
	<br/>
    <canvas nx="slider" id="sensorLop" label="Low pass rolloff frequency" min="0" max="127" height="50" width="150" log="true"></canvas>
	<canvas nx="slider" id="sensorGain" label="Gain" min="0" max="6" height="50" width="100"></canvas>
	<script>

	var patchUrl = 'pd/3B.sensor.pd'

		nxonload[patchUrl] = function() {
			
			if (sensorLop) {
				sensorLop.on('value', function(data) {
					Pd.send('sensorLop', [data])
				})
					Pd.receive('sensorLopInit', function(args) {
						sensorLop.set({
							value: args[0]
						})
					})
			}
			if (sensorGain) {
				sensorGain.on('value', function(data) {
					Pd.send('sensorGain', [data])
				})
					Pd.receive('sensorGainInit', function(args) {
						sensorGain.set({
							value: args[0]
						})
					})
			}

			$.get(patchUrl, function(mainStr) {
				// Loading the patch
				patch[patchUrl] = Pd.loadPatch(mainStr);
				var webPdContext = Pd.getAudio().context
				var audioInNode = webPdContext.createGain()
				patch[patchUrl].o(0).getOutNode().connect(audioInNode)
				meterIn.setup(webPdContext,audioInNode);
				oscilloscopeIn.setup(webPdContext,audioInNode);
				var audioOutNode = webPdContext.createGain()
				patch[patchUrl].o(1).getOutNode().connect(audioOutNode)
				meterOut.setup(webPdContext,audioOutNode);
				oscilloscopeOut.setup(webPdContext,audioOutNode);
			})
		}
		
		addLoadEvent(nxonload[patchUrl])
	
	Pd.start();
	</script>
  </body>
</html>